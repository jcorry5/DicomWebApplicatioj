function openTestImage(){var n=new Image;canvas=document.getElementById("image-canvas");canvas2=document.getElementById("anno-canvas");context=canvas.getContext("2d");n.onload=function(){canvas.width=n.width;canvas.height=n.height;canvas2.width=n.width;canvas2.height=n.height;context.drawImage(n,0,0)};n.src="../images/test.jpg";imageType=!0}function loadImageFromDrop(n){var t=new FileReader;t.onload=function(n){render(n.target.result)};t.readAsDataURL(n)}function render(n){imagedata=n;$(document).ready(function(){$("#canvasDiv").show();$("#fileSelectdiv").hide();$("#closeImage").show()});canvas=document.getElementById("image-canvas");canvas2=document.getElementById("anno-canvas");var t=new Image;t.onload=function(){t.height>MAX_HEIGHT&&(t.width*=MAX_HEIGHT/t.height,t.height=MAX_HEIGHT);var n=canvas.getContext("2d");n.clearRect(0,0,canvas.width,canvas.height);canvas.width=t.width;canvas.height=t.height;canvas2.width=t.width;canvas2.height=t.height;n.drawImage(t,0,0,t.width,t.height);imageType=!1};t.src=n}function handleDragOver(n){n.stopPropagation();n.preventDefault();n.dataTransfer.dropEffect="copy"}function handleFileSelect(n){n.stopPropagation();n.preventDefault();const t=n.dataTransfer.files;file=t[0];const i=cornerstoneWADOImageLoader.wadouri.fileManager.add(file);console.log("IMAGEid");loadAndViewImage(i);console.log("handling")}function loadAndViewImage(n){const t=document.getElementById("canvasDiv"),i=(new Date).getTime();cornerstone.loadImage(n).then(function(n){console.log(n);const i=cornerstone.getDefaultViewportForImage(t,n);cornerstone.displayImage(t,n,i);loaded===!1&&(cornerstoneTools.mouseInput.enable(t),cornerstoneTools.mouseWheelInput.enable(t),cornerstoneTools.wwwc.activate(t,1),cornerstoneTools.pan.activate(t,2),cornerstoneTools.zoom.activate(t,4),cornerstoneTools.zoomWheel.activate(t),cornerstoneTools.imageStats.enable(t),loaded=!0)},function(n){alert(n)})}var imageType=!1,canvas,canvas2,context,MAX_HEIGHT=window.innerHeight,imagedata,openTest=document.getElementById("openTestImage"),erase,imageFile,target,button,dropZone;openTest.addEventListener("click",function(){openTestImage()});erase=document.getElementById("erase");erase.addEventListener("click",function(){canvas=document.getElementById("image-canvas");context=canvas.getContext("2d");context.clearRect(0,0,canvas.width,canvas.height);context.save();imageType===!1?render(imagedata):openTestImage()});imageFile=document.getElementById("imagefile");imageFile.addEventListener("change",loadImageFromDrop,!1);document.getElementById("imagefile").addEventListener("change",function(n){var t,r,i;const u=n.target.files[0];loadImageFromDrop(u);t=document.getElementById("imagefile").value;t&&(r=t.indexOf("\\")>=0?t.lastIndexOf("\\"):t.lastIndexOf("/"),i=t.substring(r),(i.indexOf("\\")===0||i.indexOf("/")===0)&&(i=i.substring(1)),document.getElementById("workingFile").innerHTML=i)});target=document.getElementById("dropZone");target.addEventListener("dragover",function(n){n.preventDefault();n.dataTransfer.dropEffect="copy"},!0);target.addEventListener("drop",function(n){n.preventDefault();loadImageFromDrop(n.dataTransfer.files[0]);document.getElementById("workingFile").innerHTML=n.dataTransfer.files[0].name},!0);button=document.getElementById("downloadImage");button.addEventListener("click",function(){try{var n=canvas.toDataURL("image/png");button.href=n}catch(t){console.log("storage failed:"+t)}});let loaded=!1;const element=document.getElementById("canvasDiv");cornerstone.enable(element);document.getElementById("dicomfile").addEventListener("change",function(n){const t=n.target.files[0],i=cornerstoneWADOImageLoader.wadouri.fileManager.add(t);console.log("IMAGEid");loadAndViewImage(i);console.log("handling")});dropZone=document.getElementById("dropZoneDicom");dropZone.addEventListener("dragover",handleDragOver,!1);dropZone.addEventListener("drop",handleFileSelect,!1);