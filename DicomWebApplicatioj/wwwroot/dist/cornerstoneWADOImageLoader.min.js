/*! cornerstone-wado-image-loader - 2.1.0 - 2018-04-11 | (c) 2016 Chris Hafey | https://github.com/cornerstonejs/cornerstoneWADOImageLoader */
(function(n,t){typeof exports=="object"&&typeof module=="object"?module.exports=t(require("dicom-parser")):typeof define=="function"&&define.amd?define("cornerstoneWADOImageLoader",["dicom-parser"],t):typeof exports=="object"?exports.cornerstoneWADOImageLoader=t(require("dicom-parser")):n.cornerstoneWADOImageLoader=t(n.dicomParser)})(window,function(n){return function(n){function t(r){if(i[r])return i[r].exports;var u=i[r]={i:r,l:!1,exports:{}};return n[r].call(u.exports,u,u.exports,t),u.l=!0,u.exports}var i={};return t.m=n,t.c=i,t.d=function(n,i,r){t.o(n,i)||Object.defineProperty(n,i,{configurable:!1,enumerable:!0,get:r})},t.r=function(n){Object.defineProperty(n,"__esModule",{value:!0})},t.n=function(n){var i=n&&n.__esModule?function(){return n["default"]}:function(){return n};return t.d(i,"a",i),i},t.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},t.p="",t(t.s="./imageLoader/index.js")}({"./externalModules.js":function(n,t,i){"use strict";function h(n){return n&&n.__esModule?n:{"default":n}}function c(n){var t,i;if(n&&n.__esModule)return n;if(t={},n!=null)for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t.default=n,t}var r,u;Object.defineProperty(t,"__esModule",{value:!0});t.external=t.dicomParser=undefined;var f=i("dicom-parser"),e=c(f),o=i("./imageLoader/registerLoaders.js"),s=h(o);r=void 0;u={set cornerstone(n){r=n;s.default(r)},get cornerstone(){return r}};t.dicomParser=e;t.external=u},"./imageLoader/colorSpaceConverters/convertPALETTECOLOR.js":function(n,t){"use strict";function i(n,t){for(var r=n.length,u=new Uint8ClampedArray(r),i=0;i<r;++i)u[i]=n[i]>>t;return u}Object.defineProperty(t,"__esModule",{value:!0});t.default=function(n,t){for(var r,h=n.columns*n.rows,c=n.pixelData,l=n.redPaletteColorLookupTableData,a=n.greenPaletteColorLookupTableData,v=n.bluePaletteColorLookupTableData,o=n.redPaletteColorLookupTableData.length,y=0,u=0,f=n.redPaletteColorLookupTableDescriptor[1],e=n.redPaletteColorLookupTableDescriptor[2]===8?0:8,p=i(l,e),w=i(a,e),b=i(v,e),s=0;s<h;++s)r=c[y++],r<f?r=0:r>f+o-1?r=o-1:r-=f,t[u++]=p[r],t[u++]=w[r],t[u++]=b[r],t[u++]=255}},"./imageLoader/colorSpaceConverters/convertRGBColorByPixel.js":function(n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(n,t){var u;if(n===undefined)throw new Error("decodeRGB: rgbBuffer must not be undefined");if(n.length%3!=0)throw new Error("decodeRGB: rgbBuffer length must be divisible by 3");var f=n.length/3,r=0,i=0;for(u=0;u<f;u++)t[i++]=n[r++],t[i++]=n[r++],t[i++]=n[r++],t[i++]=255}},"./imageLoader/colorSpaceConverters/convertRGBColorByPlane.js":function(n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(n,t){var u;if(n===undefined)throw new Error("decodeRGB: rgbBuffer must not be undefined");if(n.length%3!=0)throw new Error("decodeRGB: rgbBuffer length must be divisible by 3");var r=n.length/3,i=0,f=0,e=r,o=r*2;for(u=0;u<r;u++)t[i++]=n[f++],t[i++]=n[e++],t[i++]=n[o++],t[i++]=255}},"./imageLoader/colorSpaceConverters/convertYBRFullByPixel.js":function(n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(n,t){var u;if(n===undefined)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(n.length%3!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");var s=n.length/3,r=0,i=0;for(u=0;u<s;u++){var f=n[r++],e=n[r++],o=n[r++];t[i++]=f+1.402*(o-128);t[i++]=f-.34414*(e-128)-.71414*(o-128);t[i++]=f+1.772*(e-128);t[i++]=255}}},"./imageLoader/colorSpaceConverters/convertYBRFullByPlane.js":function(n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(n,t){var u;if(n===undefined)throw new Error("decodeRGB: ybrBuffer must not be undefined");if(n.length%3!=0)throw new Error("decodeRGB: ybrBuffer length must be divisble by 3");var r=n.length/3,i=0,s=0,h=r,c=r*2;for(u=0;u<r;u++){var f=n[s++],e=n[h++],o=n[c++];t[i++]=f+1.402*(o-128);t[i++]=f-.34414*(e-128)-.71414*(o-128);t[i++]=f+1.772*(e-128);t[i++]=255}}},"./imageLoader/colorSpaceConverters/index.js":function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}var u,f,e,o,s;Object.defineProperty(t,"__esModule",{value:!0});u=i("./imageLoader/colorSpaceConverters/convertRGBColorByPixel.js");Object.defineProperty(t,"convertRGBColorByPixel",{enumerable:!0,get:function(){return r(u).default}});f=i("./imageLoader/colorSpaceConverters/convertRGBColorByPlane.js");Object.defineProperty(t,"convertRGBColorByPlane",{enumerable:!0,get:function(){return r(f).default}});e=i("./imageLoader/colorSpaceConverters/convertYBRFullByPixel.js");Object.defineProperty(t,"convertYBRFullByPixel",{enumerable:!0,get:function(){return r(e).default}});o=i("./imageLoader/colorSpaceConverters/convertYBRFullByPlane.js");Object.defineProperty(t,"convertYBRFullByPlane",{enumerable:!0,get:function(){return r(o).default}});s=i("./imageLoader/colorSpaceConverters/convertPALETTECOLOR.js");Object.defineProperty(t,"convertPALETTECOLOR",{enumerable:!0,get:function(){return r(s).default}})},"./imageLoader/configure.js":function(n,t,i){"use strict";function u(n){r.setOptions(n)}Object.defineProperty(t,"__esModule",{value:!0});var r=i("./imageLoader/internal/index.js");t.default=u},"./imageLoader/convertColorSpace.js":function(n,t,i){"use strict";function u(n,t){n.planarConfiguration===0?r.convertRGBColorByPixel(n.pixelData,t):r.convertRGBColorByPlane(n.pixelData,t)}function f(n,t){n.planarConfiguration===0?r.convertYBRFullByPixel(n.pixelData,t):r.convertYBRFullByPlane(n.pixelData,t)}function e(n,t){var i=t.data;if(n.photometricInterpretation==="RGB")u(n,i);else if(n.photometricInterpretation==="YBR_RCT")u(n,i);else if(n.photometricInterpretation==="YBR_ICT")u(n,i);else if(n.photometricInterpretation==="PALETTE COLOR")r.convertPALETTECOLOR(n,i);else if(n.photometricInterpretation==="YBR_FULL_422")u(n,i);else if(n.photometricInterpretation==="YBR_FULL")f(n,i);else throw new Error("No color space conversion for photometric interpretation "+n.photometricInterpretation);}Object.defineProperty(t,"__esModule",{value:!0});t.default=e;var r=i("./imageLoader/colorSpaceConverters/index.js")},"./imageLoader/createImage.js":function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function k(n){return n!=="1.2.840.10008.5.1.4.1.1.12.1"&&n!=="1.2.840.10008.5.1.4.1.1.12.2.1"}function d(n){for(var i,r=f.default(n),l=Math.abs(r.max-r.min),o=l/65535,s=r.min,h=n.length,c=new Uint16Array(h),u=65535,e=0,t=0;t<h;t++)i=Math.floor((n[t]-s)/o),c[t]=i,u=Math.min(u,i),e=Math.max(e,i);return{min:u,max:e,intPixelData:c,slope:o,intercept:s}}function g(n){n.pixelData=n.bitsAllocated===32?new Float32Array(n.pixelData):n.bitsAllocated===16?n.pixelRepresentation===0?new Uint16Array(n.pixelData):new Int16Array(n.pixelData):new Uint8Array(n.pixelData)}function nt(n,t,i,r){if(!t||!t.length)return Promise.reject(new Error("The file does not contain image data."));var h=e.external.cornerstone,o=document.createElement("canvas"),l=s.default(n),v=c.default(l,i,t,o,r);return new Promise(function(t,r){v.then(function(r){var v=h.metaData.get("imagePlaneModule",n)||{},s=h.metaData.get("voiLutModule",n)||{},c=h.metaData.get("modalityLutModule",n)||{},ft=h.metaData.get("sopCommonModule",n)||{},rt=a.default(r.photometricInterpretation),ut,p,w,e,nt,l,tt,it;b.default(r,i)||(g(r),rt&&(o.height=r.rows,o.width=r.columns,ut=o.getContext("2d"),p=ut.createImageData(r.columns,r.rows),y.default(r,p),r.imageData=p,r.pixelData=p.data,w=f.default(r.pixelData),r.smallestPixelValue=w.min,r.largestPixelValue=w.max));e={imageId:n,color:rt,columnPixelSpacing:v.pixelSpacing?v.pixelSpacing[1]:undefined,columns:r.columns,height:r.rows,intercept:c.rescaleIntercept?c.rescaleIntercept:0,invert:r.photometricInterpretation==="MONOCHROME1",minPixelValue:r.smallestPixelValue,maxPixelValue:r.largestPixelValue,render:undefined,rowPixelSpacing:v.pixelSpacing?v.pixelSpacing[0]:undefined,rows:r.rows,sizeInBytes:r.pixelData.length,slope:c.rescaleSlope?c.rescaleSlope:1,width:r.columns,windowCenter:s.windowCenter?s.windowCenter[0]:undefined,windowWidth:s.windowWidth?s.windowWidth[0]:undefined,decodeTimeInMS:r.decodeTimeInMS,floatPixelData:undefined};r.pixelData instanceof Float32Array?(nt=r.pixelData,l=d(nt),e.minPixelValue=l.min,e.maxPixelValue=l.max,e.slope=l.slope,e.intercept=l.intercept,e.floatPixelData=nt,e.getPixelData=function(){return l.intPixelData}):e.getPixelData=function(){return r.pixelData};e.color?(e.render=h.renderColorImage,e.getCanvas=function(){if(u===n)return o;o.height=e.rows;o.width=e.columns;var t=o.getContext("2d");return t.putImageData(r.imageData,0,0),u=n,o}):e.render=h.renderGrayscaleImage;c.modalityLUTSequence&&c.modalityLUTSequence.length>0&&k(ft.sopClassUID)&&(e.modalityLUT=c.modalityLUTSequence[0]);s.voiLUTSequence&&s.voiLUTSequence.length>0&&(e.voiLUT=s.voiLUTSequence[0]);e.color&&(e.windowWidth=255,e.windowCenter=127);(e.windowCenter===undefined||e.windowWidth===undefined)&&(tt=e.maxPixelValue*e.slope+e.intercept,it=e.minPixelValue*e.slope+e.intercept,e.windowWidth=tt-it,e.windowCenter=(tt+it)/2);t(e)},r)})}var u;Object.defineProperty(t,"__esModule",{value:!0});var e=i("./externalModules.js"),o=i("./imageLoader/getImageFrame.js"),s=r(o),h=i("./imageLoader/decodeImageFrame.js"),c=r(h),l=i("./imageLoader/isColorImage.js"),a=r(l),v=i("./imageLoader/convertColorSpace.js"),y=r(v),p=i("./shared/getMinMax.js"),f=r(p),w=i("./imageLoader/isJPEGBaseline8BitColor.js"),b=r(w);u="";t.default=nt},"./imageLoader/decodeImageFrame.js":function(n,t,i){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}function r(n,t,i,r){var h=r.priority||undefined,c=r.transferPixelData?[i.buffer]:undefined,u=e.getOptions(),l=u.strict,o=u.decodeConfig,v=u.useWebWorkers;return v===!1?(f===!1&&(p.initializeJPEG2000(o),w.initializeJPEGLS(o),f=!0),new Promise(function(u,f){try{var s=[n,t,i,o,r],e=a.default.apply(undefined,s);y.default(e,l);u(e)}catch(h){f(h)}})):s.default.addTask("decodeTask",{imageFrame:n,transferSyntax:t,pixelData:i,options:r},h,c).promise}function b(n,t,i,u){var f=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};return t==="1.2.840.10008.1.2"?r(n,t,i,f):t==="1.2.840.10008.1.2.1"||t==="1.2.840.10008.1.2.2"||t==="1.2.840.10008.1.2.1.99"||t==="1.2.840.10008.1.2.5"?r(n,t,i,f):t==="1.2.840.10008.1.2.4.50"?n.bitsAllocated===8&&(n.samplesPerPixel===3||n.samplesPerPixel===4)?c.default(n,i,u):r(n,t,i,f):t==="1.2.840.10008.1.2.4.51"||t==="1.2.840.10008.1.2.4.57"||t==="1.2.840.10008.1.2.4.70"||t==="1.2.840.10008.1.2.4.80"||t==="1.2.840.10008.1.2.4.81"||t==="1.2.840.10008.1.2.4.90"||t==="1.2.840.10008.1.2.4.91"?r(n,t,i,f):new Promise(function(n,i){i(new Error("No decoder for transfer syntax "+t))})}var f;Object.defineProperty(t,"__esModule",{value:!0});var e=i("./imageLoader/internal/options.js"),o=i("./imageLoader/webWorkerManager.js"),s=u(o),h=i("./imageLoader/decodeJPEGBaseline8BitColor.js"),c=u(h),l=i("./shared/decodeImageFrame.js"),a=u(l),v=i("./shared/calculateMinMax.js"),y=u(v),p=i("./shared/decoders/decodeJPEG2000.js"),w=i("./shared/decoders/decodeJPEGLS.js");f=!1;t.default=b},"./imageLoader/decodeJPEGBaseline8BitColor.js":function(n,t,i){"use strict";function f(n){return n&&n.__esModule?n:{"default":n}}function e(n){return o(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(n))))}function o(n){var t=void 0;try{return decodeURIComponent(escape(n))}catch(i){if(t=i,t instanceof URIError)return n;throw t;}}function s(n,t,i){var f=(new Date).getTime(),r=new Blob([t],{type:"image/jpeg"});return new Promise(function(t,o){var s=new FileReader;s.readAsBinaryString===undefined?s.readAsArrayBuffer(r):s.readAsBinaryString(r);s.onload=function(){var r=new Image;r.onload=function(){var e,o,h,s;i.height=r.height;i.width=r.width;n.rows=r.height;n.columns=r.width;e=i.getContext("2d");e.drawImage(this,0,0);o=e.getImageData(0,0,r.width,r.height);h=(new Date).getTime();n.pixelData=o.data;n.imageData=o;n.decodeTimeInMS=h-f;s=u.default(n.pixelData);n.smallestPixelValue=s.min;n.largestPixelValue=s.max;t(n)};r.onerror=function(n){o(n)};r.src=s.readAsBinaryString===undefined?"data:image/jpeg;base64,"+window.btoa(e(s.result)):"data:image/jpeg;base64,"+window.btoa(s.result)};s.onerror=function(n){o(n)}})}Object.defineProperty(t,"__esModule",{value:!0});var r=i("./shared/getMinMax.js"),u=f(r);t.default=s},"./imageLoader/getImageFrame.js":function(n,t,i){"use strict";function u(n){var t=r.external.cornerstone.metaData.get("imagePixelModule",n);return{samplesPerPixel:t.samplesPerPixel,photometricInterpretation:t.photometricInterpretation,planarConfiguration:t.planarConfiguration,rows:t.rows,columns:t.columns,bitsAllocated:t.bitsAllocated,bitsStored:t.bitsStored,pixelRepresentation:t.pixelRepresentation,smallestPixelValue:t.smallestPixelValue,largestPixelValue:t.largestPixelValue,redPaletteColorLookupTableDescriptor:t.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:t.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:t.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:t.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:t.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:t.bluePaletteColorLookupTableData,pixelData:undefined}}Object.defineProperty(t,"__esModule",{value:!0});var r=i("./externalModules.js");t.default=u},"./imageLoader/index.js":function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}var u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d;Object.defineProperty(t,"__esModule",{value:!0});u=i("./imageLoader/colorSpaceConverters/index.js");Object.keys(u).forEach(function(n){n!=="default"&&n!=="__esModule"&&Object.defineProperty(t,n,{enumerable:!0,get:function(){return u[n]}})});f=i("./imageLoader/wadouri/index.js");Object.defineProperty(t,"wadouri",{enumerable:!0,get:function(){return r(f).default}});e=i("./imageLoader/wadors/index.js");Object.defineProperty(t,"wadors",{enumerable:!0,get:function(){return r(e).default}});o=i("./imageLoader/configure.js");Object.defineProperty(t,"configure",{enumerable:!0,get:function(){return r(o).default}});s=i("./imageLoader/convertColorSpace.js");Object.defineProperty(t,"convertColorSpace",{enumerable:!0,get:function(){return r(s).default}});h=i("./imageLoader/createImage.js");Object.defineProperty(t,"createImage",{enumerable:!0,get:function(){return r(h).default}});c=i("./imageLoader/decodeImageFrame.js");Object.defineProperty(t,"decodeImageFrame",{enumerable:!0,get:function(){return r(c).default}});l=i("./imageLoader/decodeJPEGBaseline8BitColor.js");Object.defineProperty(t,"decodeJPEGBaseline8BitColor",{enumerable:!0,get:function(){return r(l).default}});a=i("./imageLoader/getImageFrame.js");Object.defineProperty(t,"getImageFrame",{enumerable:!0,get:function(){return r(a).default}});v=i("./shared/getMinMax.js");Object.defineProperty(t,"getMinMax",{enumerable:!0,get:function(){return r(v).default}});y=i("./imageLoader/isColorImage.js");Object.defineProperty(t,"isColorImage",{enumerable:!0,get:function(){return r(y).default}});p=i("./imageLoader/isJPEGBaseline8BitColor.js");Object.defineProperty(t,"isJPEGBaseline8BitColor",{enumerable:!0,get:function(){return r(p).default}});w=i("./imageLoader/webWorkerManager.js");Object.defineProperty(t,"webWorkerManager",{enumerable:!0,get:function(){return r(w).default}});b=i("./version.js");Object.defineProperty(t,"version",{enumerable:!0,get:function(){return r(b).default}});k=i("./imageLoader/internal/index.js");Object.defineProperty(t,"internal",{enumerable:!0,get:function(){return k.internal}});d=i("./externalModules.js");Object.defineProperty(t,"external",{enumerable:!0,get:function(){return d.external}})},"./imageLoader/internal/index.js":function(n,t,i){"use strict";function o(n){return n&&n.__esModule?n:{"default":n}}var f;Object.defineProperty(t,"__esModule",{value:!0});t.internal=t.xhrRequest=t.getOptions=t.setOptions=undefined;var e=i("./imageLoader/internal/xhrRequest.js"),u=o(e),r=i("./imageLoader/internal/options.js");f={xhrRequest:u.default,setOptions:r.setOptions,getOptions:r.getOptions};t.setOptions=r.setOptions;t.getOptions=r.getOptions;t.xhrRequest=u.default;t.internal=f},"./imageLoader/internal/options.js":function(n,t){"use strict";function r(n){i=Object.assign(i,n)}function u(){return i}Object.defineProperty(t,"__esModule",{value:!0});t.setOptions=r;t.getOptions=u;var i={beforeSend:function(){},imageCreated:function(){},strict:!1,useWebWorkers:!0,decodeConfig:{usePDFJS:!1}}},"./imageLoader/internal/xhrRequest.js":function(n,t,i){"use strict";function f(n,t){var o=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},f=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{},e=r.external.cornerstone,i=u.getOptions();return new Promise(function(r,u){var s=new XMLHttpRequest;s.open("get",n,!0);s.responseType="arraybuffer";i.beforeSend(s,t);Object.keys(o).forEach(function(n){s.setRequestHeader(n,o[n])});f.deferred={resolve:r,reject:u};f.url=n;f.imageId=t;s.onloadstart=function(r){if(i.onloadstart)i.onloadstart(r,f);var u={url:n,imageId:t};e.triggerEvent(e.events,"cornerstoneimageloadstart",u)};s.onloadend=function(r){if(i.onloadend)i.onloadend(r,f);var u={url:n,imageId:t};e.triggerEvent(e.events,"cornerstoneimageloadend",u)};s.onreadystatechange=function(n){if(i.onreadystatechange){i.onreadystatechange(n,f);return}s.readyState===4&&(s.status===200?r(s.response,s):u(s))};s.onprogress=function(r){var o=r.loaded,u=void 0,s=void 0,h;if(r.lengthComputable&&(u=r.total,s=Math.round(o/u*100)),i.onprogress)i.onprogress(r,f);h={url:n,imageId:t,loaded:o,total:u,percentComplete:s};e.triggerEvent(e.events,"cornerstoneimageloadprogress",h)};s.send()})}Object.defineProperty(t,"__esModule",{value:!0});var r=i("./externalModules.js"),u=i("./imageLoader/internal/options.js");t.default=f},"./imageLoader/isColorImage.js":function(n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(n){return n==="RGB"||n==="PALETTE COLOR"||n==="YBR_FULL"||n==="YBR_FULL_422"||n==="YBR_PARTIAL_422"||n==="YBR_PARTIAL_420"||n==="YBR_RCT"||n==="YBR_ICT"}},"./imageLoader/isJPEGBaseline8BitColor.js":function(n,t){"use strict";function i(n,t){return t=t||n.transferSyntax,n.bitsAllocated===8&&t==="1.2.840.10008.1.2.4.50"&&(n.samplesPerPixel===3||n.samplesPerPixel===4)?!0:void 0}Object.defineProperty(t,"__esModule",{value:!0});t.default=i},"./imageLoader/registerLoaders.js":function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function s(n){f.default.register(n);o.default.register(n)}Object.defineProperty(t,"__esModule",{value:!0});var u=i("./imageLoader/wadors/index.js"),f=r(u),e=i("./imageLoader/wadouri/index.js"),o=r(e);t.default=s},"./imageLoader/wadors/findIndexOfString.js":function(n,t){"use strict";function i(n,t,i){var u,r;if(i+n.length>t.length)return!1;for(u=i,r=0;r<n.length;r++)if(n[r]!==t[u++])return!1;return!0}function r(n){for(var i=new Uint8Array(n.length),t=0,r=n.length;t<r;t++)i[t]=n.charCodeAt(t);return i}function u(n,t,u){var e,f;for(u=u||0,e=r(t),f=u;f<n.length;f++)if(e[0]===n[f]&&i(e,n,f))return f;return-1}Object.defineProperty(t,"__esModule",{value:!0});t.default=u},"./imageLoader/wadors/getPixelData.js":function(n,t,i){"use strict";function e(n){return n&&n.__esModule?n:{"default":n}}function o(n){for(var t=0;t<n.length;t++)if(n[t].substr(0,2)==="--")return n[t]}function s(n){for(var t=0;t<n.length;t++)if(n[t].substr(0,13)==="Content-Type:")return n[t].substr(13).trim()}function h(n,t,i){var u,r;for(t=t||0,i=i||n.length-t,u="",r=t;r<t+i;r++)u+=String.fromCharCode(n[r]);return u}function c(n,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"application/octet-stream",f={accept:i};return new Promise(function(i,e){var c=u.xhrRequest(n,t,f);c.then(function(n){var u=new Uint8Array(n),f=r.default(u,"\r\n\r\n"),t,c,v;f===-1&&e(new Error("invalid response - no multipart mime header"));var y=h(u,0,f),l=y.split("\r\n"),a=o(l);a||e(new Error("invalid response - no boundary marker"));t=f+4;c=r.default(u,a,t);c===-1&&e(new Error("invalid response - terminating boundary not found"));v=c-t-2;i({contentType:s(l),imageFrame:{pixelData:new Uint8Array(n,t,v)}})})})}Object.defineProperty(t,"__esModule",{value:!0});var u=i("./imageLoader/internal/index.js"),f=i("./imageLoader/wadors/findIndexOfString.js"),r=e(f);t.default=c},"./imageLoader/wadors/index.js":function(n,t,i){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}var f;Object.defineProperty(t,"__esModule",{value:!0});var r=i("./imageLoader/wadors/metaData/index.js"),e=i("./imageLoader/wadors/findIndexOfString.js"),o=u(e),s=i("./imageLoader/wadors/getPixelData.js"),h=u(s),c=i("./imageLoader/wadors/metaDataManager.js"),l=u(c),a=i("./imageLoader/wadors/loadImage.js"),v=u(a),y=i("./imageLoader/wadors/register.js"),p=u(y);f={getNumberString:r.getNumberString,getNumberValue:r.getNumberValue,getNumberValues:r.getNumberValues,getValue:r.getValue,metaDataProvider:r.metaDataProvider};t.default={metaData:f,findIndexOfString:o.default,getPixelData:h.default,loadImage:v.default,metaDataManager:l.default,register:p.default}},"./imageLoader/wadors/loadImage.js":function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function u(n){var i="1.2.840.10008.1.2",r,u,f,t;if(n){r=n.split(";");for(u in r)(f=r[u],t=f.split("="),t.length===2)&&t[0].trim()==="transfer-syntax"&&(i=t[1].trim()||i)}return i}function l(n,t){var i=(new Date).getTime(),r=n.substring(7),f=new Promise(function(f,o){var a=e.default.get(n),h,l;if(a===undefined)return h=new Error("no metadata for imageId "+n),o(h);l='multipart/related; type="application/octet-stream"';s.default(r,n,l).then(function(r){var e=u(r.contentType),s=r.imageFrame.pixelData,h=c.default(n,s,e,t);h.then(function(n){var t=(new Date).getTime();n.loadTimeInMS=t-i;f(n)},o)},o)});return{promise:f,cancelFn:undefined}}Object.defineProperty(t,"__esModule",{value:!0});t.getTransferSyntaxForContentType=u;var f=i("./imageLoader/wadors/metaDataManager.js"),e=r(f),o=i("./imageLoader/wadors/getPixelData.js"),s=r(o),h=i("./imageLoader/createImage.js"),c=r(h);t.default=l},"./imageLoader/wadors/metaData/getNumberString.js":function(n,t,i){"use strict";function f(n){return n&&n.__esModule?n:{"default":n}}function e(n,t,i){var r=u.default(n,t,i);if(r!==undefined)return parseFloat(r)}Object.defineProperty(t,"__esModule",{value:!0});var r=i("./imageLoader/wadors/metaData/getValue.js"),u=f(r);t.default=e},"./imageLoader/wadors/metaData/getNumberValue.js":function(n,t,i){"use strict";function f(n){return n&&n.__esModule?n:{"default":n}}function e(n,t){var i=u.default(n,t);if(i!==undefined)return parseFloat(i)}Object.defineProperty(t,"__esModule",{value:!0});var r=i("./imageLoader/wadors/metaData/getValue.js"),u=f(r);t.default=e},"./imageLoader/wadors/metaData/getNumberValues.js":function(n,t){"use strict";function i(n,t){var r,i;if(n&&n.Value&&(!t||!(n.Value.length<t))){for(r=[],i=0;i<n.Value.length;i++)r.push(parseFloat(n.Value[i]));return r}}Object.defineProperty(t,"__esModule",{value:!0});t.default=i},"./imageLoader/wadors/metaData/getValue.js":function(n,t){"use strict";function i(n,t,i){return(t=t||0,!n)?i:n.Value?n.Value.length<=t?i:n.Value[t]:i}Object.defineProperty(t,"__esModule",{value:!0});t.default=i},"./imageLoader/wadors/metaData/index.js":function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}var u,f,e,o,s;Object.defineProperty(t,"__esModule",{value:!0});u=i("./imageLoader/wadors/metaData/getNumberString.js");Object.defineProperty(t,"getNumberString",{enumerable:!0,get:function(){return r(u).default}});f=i("./imageLoader/wadors/metaData/getNumberValue.js");Object.defineProperty(t,"getNumberValue",{enumerable:!0,get:function(){return r(f).default}});e=i("./imageLoader/wadors/metaData/getNumberValues.js");Object.defineProperty(t,"getNumberValues",{enumerable:!0,get:function(){return r(e).default}});o=i("./imageLoader/wadors/metaData/getValue.js");Object.defineProperty(t,"getValue",{enumerable:!0,get:function(){return r(o).default}});s=i("./imageLoader/wadors/metaData/metaDataProvider.js");Object.defineProperty(t,"metaDataProvider",{enumerable:!0,get:function(){return r(s).default}})},"./imageLoader/wadors/metaData/metaDataProvider.js":function(n,t,i){"use strict";function e(n){return n&&n.__esModule?n:{"default":n}}function v(n,t){var i=a.default.get(t),c,l,s;if(i){if(n==="generalSeriesModule")return{modality:u.default(i["00080060"]),seriesInstanceUID:u.default(i["0020000e"]),seriesNumber:r.default(i["00200011"]),studyInstanceUID:u.default(i["0020000d"]),seriesDate:o.dicomParser.parseDA(u.default(i["00080021"])),seriesTime:o.dicomParser.parseTM(u.default(i["00080031"],0,""))};if(n==="patientStudyModule")return{patientAge:r.default(i["00101010"]),patientSize:r.default(i["00101020"]),patientWeight:r.default(i["00101030"])};if(n==="imagePlaneModule"){var e=f.default(i["00200037"],6),p=f.default(i["00200032"],3),h=f.default(i["00280030"],2),v=1,y=1;return h&&(y=h[0],v=h[1]),c=null,l=null,e&&(c=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])],l=[parseFloat(e[3]),parseFloat(e[4]),parseFloat(e[5])]),{frameOfReferenceUID:u.default(i["00200052"]),rows:r.default(i["00280010"]),columns:r.default(i["00280011"]),imageOrientationPatient:e,rowCosines:c,columnCosines:l,imagePositionPatient:p,sliceThickness:r.default(i["00180050"]),sliceLocation:r.default(i["00201041"]),pixelSpacing:h,rowPixelSpacing:y,columnPixelSpacing:v}}return n==="imagePixelModule"?{samplesPerPixel:r.default(i["00280002"]),photometricInterpretation:u.default(i["00280004"]),rows:r.default(i["00280010"]),columns:r.default(i["00280011"]),bitsAllocated:r.default(i["00280100"]),bitsStored:r.default(i["00280101"]),highBit:u.default(i["00280102"]),pixelRepresentation:r.default(i["00280103"]),planarConfiguration:r.default(i["00280006"]),pixelAspectRatio:u.default(i["00280034"]),smallestPixelValue:r.default(i["00280106"]),largestPixelValue:r.default(i["00280107"]),redPaletteColorLookupTableDescriptor:f.default(i["00281101"]),greenPaletteColorLookupTableDescriptor:f.default(i["00281102"]),bluePaletteColorLookupTableDescriptor:f.default(i["00281103"]),redPaletteColorLookupTableData:f.default(i["00281201"]),greenPaletteColorLookupTableData:f.default(i["00281202"]),bluePaletteColorLookupTableData:f.default(i["00281203"])}:n==="voiLutModule"?{windowCenter:f.default(i["00281050"],1),windowWidth:f.default(i["00281051"],1)}:n==="modalityLutModule"?{rescaleIntercept:r.default(i["00281052"]),rescaleSlope:r.default(i["00281053"]),rescaleType:u.default(i["00281054"])}:n==="sopCommonModule"?{sopClassUID:u.default(i["00080016"]),sopInstanceUID:u.default(i["00080018"])}:n==="petIsotopeModule"?(s=u.default(i["00540016"]),s===undefined)?void 0:{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:o.dicomParser.parseTM(u.default(s["00181072"],0,"")),radionuclideTotalDose:r.default(s["00181074"]),radionuclideHalfLife:r.default(s["00181075"])}}:void 0}}Object.defineProperty(t,"__esModule",{value:!0});var o=i("./externalModules.js"),s=i("./imageLoader/wadors/metaData/getNumberValues.js"),f=e(s),h=i("./imageLoader/wadors/metaData/getValue.js"),u=e(h),c=i("./imageLoader/wadors/metaData/getNumberValue.js"),r=e(c),l=i("./imageLoader/wadors/metaDataManager.js"),a=e(l);t.default=v},"./imageLoader/wadors/metaDataManager.js":function(n,t){"use strict";function r(n,t){i[n]=t}function u(n){return i[n]}function f(n){i[n]=undefined}function e(){i=[]}Object.defineProperty(t,"__esModule",{value:!0});var i=[];t.default={add:r,get:u,remove:f,purge:e}},"./imageLoader/wadors/register.js":function(n,t,i){"use strict";function e(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(t,"__esModule",{value:!0});t.default=function(n){n.registerImageLoader("wadors",u.default);n.metaData.addProvider(f.metaDataProvider)};var r=i("./imageLoader/wadors/loadImage.js"),u=e(r),f=i("./imageLoader/wadors/metaData/index.js")},"./imageLoader/wadouri/dataSetCacheManager.js":function(n,t,i){"use strict";function h(n){return r[n]!==undefined}function c(n){if(r[n])return r[n].dataSet}function l(n){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:s.xhrRequest,l=arguments[2],i=e.external.cornerstone,h,t;return r[n]?new Promise(function(t){r[n].cacheCount++;t(r[n].dataSet)}):u[n]?(u[n].cacheCount++,u[n]):(h=c(n,l),t=new Promise(function(s,c){h.then(function(u){var l=new Uint8Array(u),h=void 0;try{h=e.dicomParser.parseDicom(l)}catch(a){return c(a)}r[n]={dataSet:h,cacheCount:t.cacheCount};o+=h.byteArray.length;s(h);i.triggerEvent(i.events,"datasetscachechanged",{uri:n,action:"loaded",cacheInfo:f()})},c).then(function(){delete u[n]},function(){delete u[n]})}),t.cacheCount=1,u[n]=t,t)}function a(n){var t=e.external.cornerstone;r[n]&&(r[n].cacheCount--,r[n].cacheCount===0&&(o-=r[n].dataSet.byteArray.length,delete r[n],t.triggerEvent(t.events,"datasetscachechanged",{uri:n,action:"unloaded",cacheInfo:f()})))}function f(){return{cacheSizeInBytes:o,numberOfDataSetsCached:Object.keys(r).length}}function v(){r={};u={}}Object.defineProperty(t,"__esModule",{value:!0});t.getInfo=f;var e=i("./externalModules.js"),s=i("./imageLoader/internal/index.js"),o=0,r={},u={};t.default={isLoaded:h,load:l,unload:a,getInfo:f,purge:v,get:c}},"./imageLoader/wadouri/fileManager.js":function(n,t){"use strict";function r(n){var t=i.push(n);return"dicomfile:"+(t-1)}function u(n){return i[n]}function f(n){i[n]=undefined}function e(){i=[]}Object.defineProperty(t,"__esModule",{value:!0});var i=[];t.default={add:r,get:u,remove:f,purge:e}},"./imageLoader/wadouri/getEncapsulatedImageFrame.js":function(n,t,i){"use strict";function u(n){var t=n.intString("x00280008"),i=n.elements.x7fe00010;return t!==i.fragments.length}function f(n,t){if(n.elements.x7fe00010&&n.elements.x7fe00010.basicOffsetTable.length)return r.dicomParser.readEncapsulatedImageFrame(n,n.elements.x7fe00010,t);if(u(n)){var i=r.dicomParser.createJPEGBasicOffsetTable(n,n.elements.x7fe00010);return r.dicomParser.readEncapsulatedImageFrame(n,n.elements.x7fe00010,t,i)}return r.dicomParser.readEncapsulatedPixelDataFromFragments(n,n.elements.x7fe00010,t)}Object.defineProperty(t,"__esModule",{value:!0});t.default=f;var r=i("./externalModules.js")},"./imageLoader/wadouri/getPixelData.js":function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function s(n){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0,i=n.elements.x7fe00010||n.elements.x7fe00008;return i?i.encapsulatedPixelData?f.default(n,t):o.default(n,t):null}Object.defineProperty(t,"__esModule",{value:!0});var u=i("./imageLoader/wadouri/getEncapsulatedImageFrame.js"),f=r(u),e=i("./imageLoader/wadouri/getUncompressedImageFrame.js"),o=r(e);t.default=s},"./imageLoader/wadouri/getUncompressedImageFrame.js":function(n,t,i){"use strict";function f(n){return n&&n.__esModule?n:{"default":n}}function e(n,t){var o=n.elements.x7fe00010||n.elements.x7fe00008,f=n.uint16("x00280100"),s=n.uint16("x00280010"),h=n.uint16("x00280011"),c=n.uint16("x00280002"),e=o.dataOffset,r=s*h*c,i=void 0;if(f===8){if(i=e+t*r,i>=n.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(n.byteArray.buffer,i,r)}if(f===16){if(i=e+t*r*2,i>=n.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(n.byteArray.buffer,i,r*2)}if(f===1){if(i=e+t*r*.125,i>=n.byteArray.length)throw new Error("frame exceeds size of pixelData");return u.default(n.byteArray,i,r)}if(f===32){if(i=e+t*r*4,i>=n.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(n.byteArray.buffer,i,r*4)}throw new Error("unsupported pixel format");}Object.defineProperty(t,"__esModule",{value:!0});var r=i("./imageLoader/wadouri/unpackBinaryFrame.js"),u=f(r);t.default=e},"./imageLoader/wadouri/index.js":function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}var e;Object.defineProperty(t,"__esModule",{value:!0});var u=i("./imageLoader/wadouri/metaData/index.js"),o=i("./imageLoader/wadouri/dataSetCacheManager.js"),s=r(o),h=i("./imageLoader/wadouri/fileManager.js"),c=r(h),l=i("./imageLoader/wadouri/getEncapsulatedImageFrame.js"),a=r(l),v=i("./imageLoader/wadouri/getUncompressedImageFrame.js"),y=r(v),p=i("./imageLoader/wadouri/loadFileRequest.js"),w=r(p),f=i("./imageLoader/wadouri/loadImage.js"),b=i("./imageLoader/wadouri/parseImageId.js"),k=r(b),d=i("./imageLoader/wadouri/unpackBinaryFrame.js"),g=r(d),nt=i("./imageLoader/wadouri/register.js"),tt=r(nt);e={getImagePixelModule:u.getImagePixelModule,getLUTs:u.getLUTs,getModalityLUTOutputPixelRepresentation:u.getModalityLUTOutputPixelRepresentation,getNumberValues:u.getNumberValues,metaDataProvider:u.metaDataProvider};t.default={metaData:e,dataSetCacheManager:s.default,fileManager:c.default,getEncapsulatedImageFrame:a.default,getUncompressedImageFrame:y.default,loadFileRequest:w.default,loadImageFromPromise:f.loadImageFromPromise,getLoaderForScheme:f.getLoaderForScheme,loadImage:f.loadImage,parseImageId:k.default,unpackBinaryFrame:g.default,register:tt.default}},"./imageLoader/wadouri/loadFileRequest.js":function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function s(n){var t=f.default(n),i=parseInt(t.url,10),r=o.default.get(i);return new Promise(function(n,t){var i=new FileReader;i.onload=function(t){var i=t.target.result;n(i)};i.onerror=t;i.readAsArrayBuffer(r)})}Object.defineProperty(t,"__esModule",{value:!0});var u=i("./imageLoader/wadouri/parseImageId.js"),f=r(u),e=i("./imageLoader/wadouri/fileManager.js"),o=r(e);t.default=s},"./imageLoader/wadouri/loadImage.js":function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function b(n,t){n.decache=function(){var n=e.default(t);u.default.unload(n.url)}}function s(n,t){var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0,s=arguments[3],h=arguments[4],i=arguments[5],u=(new Date).getTime(),r={cancelFn:undefined};return r.promise=new Promise(function(c,l){n.then(function(n){var a=o.default(n,e),v=n.string("x00020010"),y=(new Date).getTime(),p=f.default(t,a,v,h);b(r,t);p.then(function(t){t.data=n;t.sharedCacheKey=s;var r=(new Date).getTime();t.loadTimeInMS=y-u;t.totalTimeInMS=r-u;i!==undefined&&i.imageDoneCallback!==undefined&&i.imageDoneCallback(t);c(t)},function(t){l({error:t,dataSet:n})})},function(n){l({error:n})})}),r}function k(n,t){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0,u=arguments[3],e=arguments[4],i=(new Date).getTime(),s=new Promise(function(s,h){var v=(new Date).getTime(),c=void 0,l,a;try{l=o.default(n,r);a=n.string("x00020010");c=f.default(t,l,a,e)}catch(y){h({error:y,dataSet:n});return}c.then(function(t){t.data=n;t.sharedCacheKey=u;var r=(new Date).getTime();t.loadTimeInMS=v-i;t.totalTimeInMS=r-i;s(t)},h)});return{promise:s,cancelFn:undefined}}function h(n){return n==="dicomweb"||n==="wadouri"?w.xhrRequest:n==="dicomfile"?y.default:void 0}function d(n,t){var i=e.default(n),r=h(i.scheme),f,o;return u.default.isLoaded(i.url)?(f=u.default.get(i.url,r,n),k(f,n,i.frame,i.url,t)):(o=u.default.load(i.url,r,n),s(o,n,i.frame,i.url,t))}Object.defineProperty(t,"__esModule",{value:!0});t.loadImage=t.getLoaderForScheme=t.loadImageFromPromise=undefined;var c=i("./imageLoader/createImage.js"),f=r(c),l=i("./imageLoader/wadouri/parseImageId.js"),e=r(l),a=i("./imageLoader/wadouri/dataSetCacheManager.js"),u=r(a),v=i("./imageLoader/wadouri/loadFileRequest.js"),y=r(v),p=i("./imageLoader/wadouri/getPixelData.js"),o=r(p),w=i("./imageLoader/internal/index.js");t.loadImageFromPromise=s;t.getLoaderForScheme=h;t.loadImage=d},"./imageLoader/wadouri/metaData/getImagePixelModule.js":function(n,t){"use strict";function i(n,t){if(n.elements[t]&&n.elements[t].length===6)return[n.uint16(t,0),n.uint16(t,1),n.uint16(t,2)]}function r(n,t,i){for(var u=[],f=n.elements[t],r=0;r<i[0];r++)u[r]=i[2]===16?n.uint16(t,r):n.byteArray[r+f.dataOffset];return u}function u(n,t){t.redPaletteColorLookupTableDescriptor=i(n,"x00281101");t.greenPaletteColorLookupTableDescriptor=i(n,"x00281102");t.bluePaletteColorLookupTableDescriptor=i(n,"x00281103");t.redPaletteColorLookupTableDescriptor[0]===0&&(t.redPaletteColorLookupTableDescriptor[0]=65536,t.greenPaletteColorLookupTableDescriptor[0]=65536,t.bluePaletteColorLookupTableDescriptor[0]=65536);var f=t.redPaletteColorLookupTableDescriptor[0],e=n.elements.x00281201,u=e.length===f?8:16;t.redPaletteColorLookupTableDescriptor[2]!==u&&(t.redPaletteColorLookupTableDescriptor[2]=u,t.greenPaletteColorLookupTableDescriptor[2]=u,t.bluePaletteColorLookupTableDescriptor[2]=u);t.redPaletteColorLookupTableData=r(n,"x00281201",t.redPaletteColorLookupTableDescriptor);t.greenPaletteColorLookupTableData=r(n,"x00281202",t.greenPaletteColorLookupTableDescriptor);t.bluePaletteColorLookupTableData=r(n,"x00281203",t.bluePaletteColorLookupTableDescriptor)}function f(n,t){var i=n.uint16("x00280103");i===0?(t.smallestPixelValue=n.uint16("x00280106"),t.largestPixelValue=n.uint16("x00280107")):(t.smallestPixelValue=n.int16("x00280106"),t.largestPixelValue=n.int16("x00280107"))}function e(n){var t={samplesPerPixel:n.uint16("x00280002"),photometricInterpretation:n.string("x00280004"),rows:n.uint16("x00280010"),columns:n.uint16("x00280011"),bitsAllocated:n.uint16("x00280100"),bitsStored:n.uint16("x00280101"),highBit:n.uint16("x00280102"),pixelRepresentation:n.uint16("x00280103"),planarConfiguration:n.uint16("x00280006"),pixelAspectRatio:n.string("x00280034")};return f(n,t),t.photometricInterpretation==="PALETTE COLOR"&&n.elements.x00281101&&u(n,t),t}Object.defineProperty(t,"__esModule",{value:!0});t.default=e},"./imageLoader/wadouri/metaData/getLUTs.js":function(n,t){"use strict";function i(n,t){var r=t.uint16("x00283002",0),u,e,f,i;for(r===0&&(r=65535),u=0,u=n===0?t.uint16("x00283002",1):t.int16("x00283002",1),e=t.uint16("x00283002",2),f={id:"1",firstValueMapped:u,numBitsPerEntry:e,lut:[]},i=0;i<r;i++)f.lut[i]=n===0?t.uint16("x00283006",i):t.int16("x00283006",i);return f}function r(n,t){var u,r,e,f;if(t&&t.items.length){for(u=[],r=0;r<t.items.length;r++)e=t.items[r].dataSet,f=i(n,e),f&&u.push(f);return u}}Object.defineProperty(t,"__esModule",{value:!0});t.default=r},"./imageLoader/wadouri/metaData/getModalityLUTOutputPixelRepresentation.js":function(n,t){"use strict";function i(n){var t=n.uint16("x00280103"),i=n.uint16("x00280101");return t===0?0:-1<<i-1}function r(n){var u=n.string("x00080016"),t,r,f,e;return u==="1.2.840.10008.5.1.4.1.1.2"||u==="1.2.840.10008.5.1.4.1.1.2.1"?1:(t=n.floatString("x00281052"),r=n.floatString("x00281053"),t!==undefined&&r!==undefined)?(f=i(n),e=f*r+t,e<0)?1:0:n.elements.x00283000&&n.elements.x00283000.length>0?0:n.uint16("x00280103")}Object.defineProperty(t,"__esModule",{value:!0});t.default=r},"./imageLoader/wadouri/metaData/getNumberValues.js":function(n,t){"use strict";function i(n,t,i){var f=[],e=n.string(t),r,u;if(e&&(r=e.split("\\"),!i||!(r.length<i))){for(u=0;u<r.length;u++)f.push(parseFloat(r[u]));return f}}Object.defineProperty(t,"__esModule",{value:!0});t.default=i},"./imageLoader/wadouri/metaData/index.js":function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}var u,f,e,o,s;Object.defineProperty(t,"__esModule",{value:!0});u=i("./imageLoader/wadouri/metaData/getImagePixelModule.js");Object.defineProperty(t,"getImagePixelModule",{enumerable:!0,get:function(){return r(u).default}});f=i("./imageLoader/wadouri/metaData/getLUTs.js");Object.defineProperty(t,"getLUTs",{enumerable:!0,get:function(){return r(f).default}});e=i("./imageLoader/wadouri/metaData/getModalityLUTOutputPixelRepresentation.js");Object.defineProperty(t,"getModalityLUTOutputPixelRepresentation",{enumerable:!0,get:function(){return r(e).default}});o=i("./imageLoader/wadouri/metaData/getNumberValues.js");Object.defineProperty(t,"getNumberValues",{enumerable:!0,get:function(){return r(o).default}});s=i("./imageLoader/wadouri/metaData/metaDataProvider.js");Object.defineProperty(t,"metaDataProvider",{enumerable:!0,get:function(){return r(s).default}})},"./imageLoader/wadouri/metaData/metaDataProvider.js":function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function b(n,t){var d=h.default(t),i=l.default.get(d.url),c,a,k,y,s;if(i){if(n==="generalSeriesModule")return{modality:i.string("x00080060"),seriesInstanceUID:i.string("x0020000e"),seriesNumber:i.intString("x00200011"),studyInstanceUID:i.string("x0020000d"),seriesDate:f.dicomParser.parseDA(i.string("x00080021")),seriesTime:f.dicomParser.parseTM(i.string("x00080031")||"")};if(n==="patientStudyModule")return{patientAge:i.intString("x00101010"),patientSize:i.floatString("x00101020"),patientWeight:i.floatString("x00101030")};if(n==="imagePlaneModule"){var r=u.default(i,"x00200037",6),g=u.default(i,"x00200032",3),o=u.default(i,"x00280030",2),p=1,b=1;return o&&(b=o[0],p=o[1]),c=null,a=null,r&&(c=[parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2])],a=[parseFloat(r[3]),parseFloat(r[4]),parseFloat(r[5])]),{frameOfReferenceUID:i.string("x00200052"),rows:i.uint16("x00280010"),columns:i.uint16("x00280011"),imageOrientationPatient:r,rowCosines:c,columnCosines:a,imagePositionPatient:g,sliceThickness:i.floatString("x00180050"),sliceLocation:i.floatString("x00201041"),pixelSpacing:o,rowPixelSpacing:b,columnPixelSpacing:p}}return n==="imagePixelModule"?v.default(i):n==="modalityLutModule"?{rescaleIntercept:i.floatString("x00281052"),rescaleSlope:i.floatString("x00281053"),rescaleType:i.string("x00281054"),modalityLUTSequence:e.default(i.uint16("x00280103"),i.elements.x00283000)}:n==="voiLutModule"?(k=w.default(i),{windowCenter:u.default(i,"x00281050",1),windowWidth:u.default(i,"x00281051",1),voiLUTSequence:e.default(k,i.elements.x00283010)}):n==="sopCommonModule"?{sopClassUID:i.string("x00080016"),sopInstanceUID:i.string("x00080018")}:n==="petIsotopeModule"?(y=i.elements.x00540016,y===undefined)?void 0:(s=y.items[0].dataSet,{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:f.dicomParser.parseTM(s.string("x00181072")||""),radionuclideTotalDose:s.floatString("x00181074"),radionuclideHalfLife:s.floatString("x00181075")}}):void 0}}Object.defineProperty(t,"__esModule",{value:!0});var f=i("./externalModules.js"),o=i("./imageLoader/wadouri/metaData/getNumberValues.js"),u=r(o),s=i("./imageLoader/wadouri/parseImageId.js"),h=r(s),c=i("./imageLoader/wadouri/dataSetCacheManager.js"),l=r(c),a=i("./imageLoader/wadouri/metaData/getImagePixelModule.js"),v=r(a),y=i("./imageLoader/wadouri/metaData/getLUTs.js"),e=r(y),p=i("./imageLoader/wadouri/metaData/getModalityLUTOutputPixelRepresentation.js"),w=r(p);t.default=b},"./imageLoader/wadouri/parseImageId.js":function(n,t){"use strict";function i(n){var r=n.indexOf(":"),t=n.substring(r+1),i=t.indexOf("frame="),u=void 0,f;return i!==-1&&(f=t.substr(i+6),u=parseInt(f,10),t=t.substr(0,i-1)),{scheme:n.substr(0,r),url:t,frame:u}}Object.defineProperty(t,"__esModule",{value:!0});t.default=i},"./imageLoader/wadouri/register.js":function(n,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(n){n.registerImageLoader("dicomweb",r.loadImage);n.registerImageLoader("wadouri",r.loadImage);n.registerImageLoader("dicomfile",r.loadImage);n.metaData.addProvider(u.metaDataProvider)};var r=i("./imageLoader/wadouri/loadImage.js"),u=i("./imageLoader/wadouri/metaData/index.js")},"./imageLoader/wadouri/unpackBinaryFrame.js":function(n,t){"use strict";function i(n,t){return n&1<<t}function r(n,t,r){for(var f=new Uint8Array(r),u=0;u<r;u++){var e=Math.floor(u/8),o=n[e+t],s=u%8;f[u]=i(o,s)?1:0}return f}Object.defineProperty(t,"__esModule",{value:!0});t.default=r},"./imageLoader/webWorkerManager.js":function(n,t,i){"use strict";function o(){var n,t,i;if(f.length){for(n=0;n<r.length;n++)if(r[n].status==="ready"){r[n].status="busy";t=f.shift();t.start=(new Date).getTime();i=(new Date).getTime();e.totalTimeDelayedInMS+=i-t.added;r[n].task=t;r[n].worker.postMessage({taskType:t.taskType,workerIndex:n,data:t.data},t.transferList);e.numTasksExecuting++;return}r.length<u.maxWebWorkers&&s()}}function y(n){var t,i;n.data.taskType==="initialize"?(r[n.data.workerIndex].status="ready",o()):(t=r[n.data.workerIndex].task.start,r[n.data.workerIndex].task.deferred.resolve(n.data.result),r[n.data.workerIndex].task=undefined,e.numTasksExecuting--,r[n.data.workerIndex].status="ready",e.numTasksCompleted++,i=(new Date).getTime(),e.totalTaskTimeInMS+=i-t,o())}function s(){if(!(r.length>=u.maxWebWorkers)){var n=new Worker(u.webWorkerPath);r.push({worker:n,status:"initializing"});n.addEventListener("message",y);n.postMessage({taskType:"initialize",workerIndex:r.length-1,config:u})}}function h(n){if(n=n||v,u)throw new Error("WebWorkerManager already initialized");if(u=n,u.maxWebWorkers=u.maxWebWorkers||navigator.hardwareConcurrency||1,!u.startWebWorkersOnDemand)for(var t=0;t<u.maxWebWorkers;t++)s()}function p(n,t){u.webWorkerTaskPaths.push(n);t&&(u.taskConfiguration=Object.assign(u.taskConfiguration,t));for(var i=0;i<r.length;i++)r[i].worker.postMessage({taskType:"loadWebWorkerTask",workerIndex:r.length-1,sourcePath:n,config:u})}function w(n,t){var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0,c=arguments[3],r;u||h();for(var s={},a=new Promise(function(n,t){s={resolve:n,reject:t}}),i=void 0,i=0;i<f.length;i++)if(f[i].priority<e)break;return r=l++,f.splice(i,0,{taskId:r,taskType:n,status:"ready",added:(new Date).getTime(),data:t,deferred:s,priority:e,transferList:c}),o(),{taskId:r,promise:a}}function b(n){for(var i,r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0,t=0;t<f.length;t++)if(f[t].taskId===n){for(i=f.splice(t,1)[0],i.priority=r,t=0;t<f.length;t++)if(f[t].priority<r)break;return f.splice(t,0,i),!0}return!1}function k(n,t){for(var r,i=0;i<f.length;i++)if(f[i].taskId===n)return r=f.splice(i,1),r.deferred.reject(t),!0;return!1}function d(){return e.maxWebWorkers=u.maxWebWorkers,e.numWebWorkers=r.length,e.numTasksQueued=f.length,e}Object.defineProperty(t,"__esModule",{value:!0});var c=i("./imageLoader/internal/options.js"),l=0,f=[],r=[],a=c.getOptions(),v={maxWebWorkers:navigator.hardwareConcurrency||1,startWebWorkersOnDemand:!0,webWorkerPath:"../../dist/cornerstoneWADOImageLoaderWebWorker.js",webWorkerTaskPaths:[],taskConfiguration:{decodeTask:{loadCodecsOnStartup:!0,initializeCodecsOnStartup:!1,codecsPath:"../dist/cornerstoneWADOImageLoaderCodecs.js",usePDFJS:!1,strict:a.strict}}},u=void 0,e={maxWebWorkers:0,numWebWorkers:0,numTasksQueued:0,numTasksExecuting:0,numTasksCompleted:0,totalTaskTimeInMS:0,totalTimeDelayedInMS:0};t.default={initialize:h,loadWebWorkerTask:p,addTask:w,getStatistics:d,setTaskPriority:b,cancelTask:k}},"./shared/calculateMinMax.js":function(n,t,i){"use strict";function f(n){return n&&n.__esModule?n:{"default":n}}function e(n){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!0,t=u.default(n.pixelData);i===!0?(n.smallestPixelValue!==t.min&&console.warn("Image smallestPixelValue tag is incorrect. Rendering performance will suffer considerably."),n.largestPixelValue!==t.max&&console.warn("Image largestPixelValue tag is incorrect. Rendering performance will suffer considerably.")):(n.smallestPixelValue=t.min,n.largestPixelValue=t.max)}Object.defineProperty(t,"__esModule",{value:!0});t.default=e;var r=i("./shared/getMinMax.js"),u=f(r)},"./shared/decodeImageFrame.js":function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function k(n,t,i,r,h){var w=(new Date).getTime(),y,a,c,p;if(t==="1.2.840.10008.1.2")n=u.default(n,i);else if(t==="1.2.840.10008.1.2.1")n=u.default(n,i);else if(t==="1.2.840.10008.1.2.2")n=l.default(n,i);else if(t==="1.2.840.10008.1.2.1.99")n=u.default(n,i);else if(t==="1.2.840.10008.1.2.5")n=v.default(n,i);else if(t==="1.2.840.10008.1.2.4.50")n=f.default(n,i);else if(t==="1.2.840.10008.1.2.4.51")n=f.default(n,i);else if(t==="1.2.840.10008.1.2.4.57")n=e.default(n,i);else if(t==="1.2.840.10008.1.2.4.70")n=e.default(n,i);else if(t==="1.2.840.10008.1.2.4.80")n=o.default(n,i);else if(t==="1.2.840.10008.1.2.4.81")n=o.default(n,i);else if(t==="1.2.840.10008.1.2.4.90")n=s.default(n,i,r,h);else if(t==="1.2.840.10008.1.2.4.91")n=s.default(n,i,r,h);else throw new Error("no decoder for transfer syntax "+t);if(y=n.pixelRepresentation!==undefined&&n.pixelRepresentation===1,a=y&&n.bitsStored!==undefined?32-n.bitsStored:undefined,y&&a!==undefined)for(c=0;c<n.pixelData.length;c++)n.pixelData[c]=n.pixelData[c]<<a>>a;return p=(new Date).getTime(),n.decodeTimeInMS=p-w,n}Object.defineProperty(t,"__esModule",{value:!0});var h=i("./shared/decoders/decodeLittleEndian.js"),u=r(h),c=i("./shared/decoders/decodeBigEndian.js"),l=r(c),a=i("./shared/decoders/decodeRLE.js"),v=r(a),y=i("./shared/decoders/decodeJPEGBaseline.js"),f=r(y),p=i("./shared/decoders/decodeJPEGLossless.js"),e=r(p),w=i("./shared/decoders/decodeJPEGLS.js"),o=r(w),b=i("./shared/decoders/decodeJPEG2000.js"),s=r(b);t.default=k},"./shared/decoders/decodeBigEndian.js":function(n,t){"use strict";function i(n){return(n&255)<<8|n>>8&255}function r(n,t){var u;if(n.bitsAllocated===16){var f=t.buffer,r=t.byteOffset,e=t.length;for(r%2&&(f=f.slice(r),r=0),n.pixelData=n.pixelRepresentation===0?new Uint16Array(f,r,e/2):new Int16Array(f,r,e/2),u=0;u<n.pixelData.length;u++)n.pixelData[u]=i(n.pixelData[u])}else n.bitsAllocated===8&&(n.pixelData=t);return n}Object.defineProperty(t,"__esModule",{value:!0});t.default=r},"./shared/decoders/decodeJPEG2000.js":function(n,t){"use strict";function u(n,t){var i=new JpxImage,r;if(i.parse(t),r=i.tiles.length,r!==1)throw new Error("JPEG2000 decoder returned a tileCount of "+r+", when 1 is expected");return n.columns=i.width,n.rows=i.height,n.pixelData=i.tiles[0].items,n}function f(n,t,r){var c=i._malloc(n.length),o,s,h,b;i.writeArrayToMemory(n,c);var l=i._malloc(4),a=i._malloc(4),v=i._malloc(4),y=i._malloc(4),p=i._malloc(4),k=(new Date).getTime(),d=i.ccall("jp2_decode","number",["number","number","number","number","number","number","number"],[c,n.length,l,a,v,y,p]);if(d!==0){console.log("[opj_decode] decoding failed!");i._free(c);i._free(i.getValue(l,"*"));i._free(v);i._free(y);i._free(a);i._free(p);return}var w=i.getValue(l,"*"),u={length:i.getValue(a,"i32"),sx:i.getValue(v,"i32"),sy:i.getValue(y,"i32"),nbChannels:i.getValue(p,"i32"),perf_timetodecode:undefined,pixelData:undefined},f=u.sx*u.sy*u.nbChannels,e=new Int32Array(i.HEAP32.buffer,w,f);if(t===1)if(Uint8Array.from)u.pixelData=Uint8Array.from(e);else for(u.pixelData=new Uint8Array(f),o=0;o<f;o++)u.pixelData[o]=e[o];else if(r)if(Int16Array.from)u.pixelData=Int16Array.from(e);else for(u.pixelData=new Int16Array(f),s=0;s<f;s++)u.pixelData[s]=e[s];else if(Uint16Array.from)u.pixelData=Uint16Array.from(e);else for(u.pixelData=new Uint16Array(f),h=0;h<f;h++)u.pixelData[h]=e[h];return b=(new Date).getTime(),u.perf_timetodecode=b-k,i._free(c),i._free(l),i._free(w),i._free(a),i._free(v),i._free(y),i._free(p),u}function e(n,t){var r=n.bitsAllocated<=8?1:2,u=n.pixelRepresentation===1,i=f(t,r,u);return n.columns=i.sx,n.rows=i.sy,n.pixelData=i.pixelData,i.nbChannels>1&&(n.photometricInterpretation="RGB"),n}function r(n){if(!n.usePDFJS&&typeof OpenJPEG=="undefined")throw new Error("OpenJPEG decoder not loaded");if(!i&&(i=OpenJPEG(),!i||!i._jp2_decode))throw new Error("OpenJPEG failed to initialize");}function o(n,t,i){var f=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};return(r(i),f.usePDFJS||i.usePDFJS)?u(n,t):e(n,t)}Object.defineProperty(t,"__esModule",{value:!0});var i=void 0;t.default=o;t.initializeJPEG2000=r},"./shared/decoders/decodeJPEGBaseline.js":function(n,t){"use strict";function i(n,t){if(typeof JpegImage=="undefined")throw new Error("No JPEG Baseline decoder loaded");var i=new JpegImage;return(i.parse(t),i.colorTransform=!1,n.bitsAllocated===8)?(n.pixelData=i.getData(n.columns,n.rows),n):n.bitsAllocated===16?(n.pixelData=i.getData16(n.columns,n.rows),n):void 0}Object.defineProperty(t,"__esModule",{value:!0});t.default=i},"./shared/decoders/decodeJPEGLS.js":function(n,t){"use strict";function u(n,t){var f=i._malloc(n.length);i.writeArrayToMemory(n,f);var e=i._malloc(4),v=i._malloc(4),o=i._malloc(4),s=i._malloc(4),h=i._malloc(4),c=i._malloc(4),y=i._malloc(4),l=i._malloc(4),a=i._malloc(4),p=i.ccall("jpegls_decode","number",["number","number","number","number","number","number","number","number","number","number","number"],[f,n.length,e,v,o,s,h,c,l,y,a]),r={result:p,width:i.getValue(o,"i32"),height:i.getValue(s,"i32"),bitsPerSample:i.getValue(h,"i32"),stride:i.getValue(c,"i32"),components:i.getValue(l,"i32"),allowedLossyError:i.getValue(y,"i32"),interleaveMode:i.getValue(a,"i32"),pixelData:undefined},u=i.getValue(e,"*");return r.bitsPerSample<=8?(r.pixelData=new Uint8Array(r.width*r.height*r.components),r.pixelData.set(new Uint8Array(i.HEAP8.buffer,u,r.pixelData.length))):t?(r.pixelData=new Int16Array(r.width*r.height*r.components),r.pixelData.set(new Int16Array(i.HEAP16.buffer,u,r.pixelData.length))):(r.pixelData=new Uint16Array(r.width*r.height*r.components),r.pixelData.set(new Uint16Array(i.HEAP16.buffer,u,r.pixelData.length))),i._free(f),i._free(u),i._free(e),i._free(v),i._free(o),i._free(s),i._free(h),i._free(c),i._free(l),i._free(a),r}function r(){if(typeof CharLS=="undefined")throw new Error("No JPEG-LS decoder loaded");if(!i&&(i=CharLS(),!i||!i._jpegls_decode))throw new Error("JPEG-LS failed to initialize");}function f(n,t){r();var i=u(t,n.pixelRepresentation===1);if(i.result!==0&&i.result!==6)throw new Error("JPEG-LS decoder failed to decode frame (error code "+i.result+")");return n.columns=i.width,n.rows=i.height,n.pixelData=i.pixelData,n}Object.defineProperty(t,"__esModule",{value:!0});var i=void 0;t.default=f;t.initializeJPEGLS=r},"./shared/decoders/decodeJPEGLossless.js":function(n,t){"use strict";function i(n,t){if(typeof jpeg=="undefined"||typeof jpeg.lossless=="undefined"||typeof jpeg.lossless.Decoder=="undefined")throw new Error("No JPEG Lossless decoder loaded");var r=n.bitsAllocated<=8?1:2,u=t.buffer,f=new jpeg.lossless.Decoder,i=f.decode(u,t.byteOffset,t.length,r);return n.pixelRepresentation===0?n.bitsAllocated===16?(n.pixelData=new Uint16Array(i.buffer),n):(n.pixelData=new Uint8Array(i.buffer),n):(n.pixelData=new Int16Array(i.buffer),n)}Object.defineProperty(t,"__esModule",{value:!0});t.default=i},"./shared/decoders/decodeLittleEndian.js":function(n,t){"use strict";function i(n,t){var r=t.buffer,i=t.byteOffset,u=t.length;return n.bitsAllocated===16?(i%2&&(r=r.slice(i),i=0),n.pixelData=n.pixelRepresentation===0?new Uint16Array(r,i,u/2):new Int16Array(r,i,u/2)):n.bitsAllocated===8||n.bitsAllocated===1?n.pixelData=t:n.bitsAllocated===32&&(i%2&&(r=r.slice(i),i=0),n.pixelData=new Float32Array(r,i,u/4)),n}Object.defineProperty(t,"__esModule",{value:!0});t.default=i},"./shared/decoders/decodeRLE.js":function(n,t){"use strict";function i(n,t){if(n.bitsAllocated===8)return n.planarConfiguration?u(n,t):r(n,t);if(n.bitsAllocated===16)return f(n,t);throw new Error("unsupported pixel format for RLE");}function r(n,t){for(var e,o,c,r,l,b,a,u=t,v=n.rows*n.columns,y=new ArrayBuffer(v*n.samplesPerPixel),s=new DataView(u.buffer,u.byteOffset),h=new Int8Array(u.buffer,u.byteOffset),p=new Int8Array(y),i=0,w=s.getInt32(0,!0),f=0;f<w;++f)for(i=f,e=s.getInt32((f+1)*4,!0),o=s.getInt32((f+2)*4,!0),o===0&&(o=u.length),c=v*w;e<o;)if(r=h[e++],r>=0&&r<=127)for(l=0;l<r+1&&i<c;++l)p[i]=h[e++],i+=n.samplesPerPixel;else if(r<=-1&&r>=-127)for(b=h[e++],a=0;a<-r+1&&i<c;++a)p[i]=b,i+=n.samplesPerPixel;return n.pixelData=new Uint8Array(y),n}function u(n,t){for(var e,o,l,r,a,b,v,u=t,s=n.rows*n.columns,y=new ArrayBuffer(s*n.samplesPerPixel),h=new DataView(u.buffer,u.byteOffset),c=new Int8Array(u.buffer,u.byteOffset),p=new Int8Array(y),i=0,w=h.getInt32(0,!0),f=0;f<w;++f)for(i=f*s,e=h.getInt32((f+1)*4,!0),o=h.getInt32((f+2)*4,!0),o===0&&(o=u.length),l=s*w;e<o;)if(r=c[e++],r>=0&&r<=127)for(a=0;a<r+1&&i<l;++a)p[i]=c[e++],i++;else if(r<=-1&&r>=-127)for(b=c[e++],v=0;v<-r+1&&i<l;++v)p[i]=b,i++;return n.pixelData=new Uint8Array(y),n}function f(n,t){for(var i,a,w,v,u=t,o=n.rows*n.columns,s=new ArrayBuffer(o*n.samplesPerPixel*2),h=new DataView(u.buffer,u.byteOffset),c=new Int8Array(u.buffer,u.byteOffset),y=new Int8Array(s),b=h.getInt32(0,!0),f=0;f<b;++f){var r=0,p=f===0?1:0,e=h.getInt32((f+1)*4,!0),l=h.getInt32((f+2)*4,!0);for(l===0&&(l=u.length);e<l;)if(i=c[e++],i>=0&&i<=127)for(a=0;a<i+1&&r<o;++a)y[r*2+p]=c[e++],r++;else if(i<=-1&&i>=-127)for(w=c[e++],v=0;v<-i+1&&r<o;++v)y[r*2+p]=w,r++}return n.pixelData=n.pixelRepresentation===0?new Uint16Array(s):new Int16Array(s),n}Object.defineProperty(t,"__esModule",{value:!0});t.default=i},"./shared/getMinMax.js":function(n,t){"use strict";function i(n){for(var t=n[0],i=n[0],r=void 0,f=n.length,u=1;u<f;u++)r=n[u],t=Math.min(t,r),i=Math.max(i,r);return{min:t,max:i}}Object.defineProperty(t,"__esModule",{value:!0});t.default=i},"./version.js":function(n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default="2.1.0"},"dicom-parser":function(t){t.exports=n}})});